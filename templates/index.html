<!DOCTYPE html>
<html>

<head>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
    
    <title>Vote</title>
</head>

<body>
    <ul id="texts">

    </ul>
    
    <hr>
    
    <input id="myInput" type="text" name="test">
    <button id="myBtn" data-vote='send'>Send</button>




    <script>

        document.addEventListener('DOMContentLoaded', () => {

            var userName = window.localStorage.getItem('userName')
            if(userName){

            } else {
                var newUserName = prompt('type display User Name');
                window.localStorage.setItem('userName', newUserName)
                userName = newUserName
            }

            // Get the input field
            var input = document.getElementById("myInput");
            var btn = document.getElementById("myBtn")

            // Execute a function when the user releases a key on the keyboard
            input.addEventListener("keyup", function (event) {
                // Number 13 is the "Enter" key on the keyboard
                if (event.keyCode === 13) {
                    // Cancel the default action, if needed
                    event.preventDefault();
                    // Trigger the button element with a click
                    btn.click();
                }
            });



            

            // Connect to websocket
            var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port);

            // When connected, configure buttons
            socket.on('connect', () => {

                

                btn.onclick = () => {
                    socket.emit('send text', { 'text': input.value });
                }


            });

            // When a new vote is announced, add to the unordered list
            socket.on('announce text', data => {
                const li = document.createElement('li');
                li.innerHTML = `${userName}: ${data.text}`;
                document.querySelector('#texts').append(li);
            })
        })
    </script>
</body>

</html>